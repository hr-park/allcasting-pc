<!DOCTYPE html>
<html lang="ko">
<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
	<title>All CASTING</title>
	<link rel="stylesheet" href="../static/css/NotoSansKR.css">
	<link rel="stylesheet" href="../static/css/style.css">
	<link rel="stylesheet" href="../static/css/swiper-bundle.min.css" />
    <link rel="stylesheet" href="../static/css/flatpickr.min.css">
	<script src="../static/js/swiper-bundle.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
	<script src="https://npmcdn.com/flatpickr/dist/l10n/ko.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
	<script src="../static/js/common.js"></script>
</head>
<body>
	<div class="wrap">
		<header class="header_type1">
			<div>
				<button type="button" id="btnPrev" class="btn_prev">이전</button>
			</div>
			<p class="page_name">오디션 일정 제안하기</p>
		</header>
		<div class="content">
			<form autocomplete="off">
				<div class="reg_form">
					<div class="inp_field essential">
						<label for="date">오디션 날짜</label>
						<div class="inp_box"><input type="text" id="date" class="inp_txt flatpickr" placeholder="오디션 날짜" onclick="javascript:openPop('pop_calendar')"/> </div>
						<span class="msg_error">필수 입력 사항입니다.</span>
					</div>
					<div class="inp_field">
						<label for="time">오디션 시간</label>
						<div class="inp_box">
							<input type="text" id="time" class="inp_txt" onclick="javascript:openPop('pop_time')" readonly placeholder="연기가 가능한 시간을 선택해 주세요."/>
						</div>
						<span class="msg_error">필수 입력 사항입니다.</span>
					</div>
					<div class="inp_field">
						<label for="age">오디션 슬롯</label>
						<div class="row">
							<div class="inp_box">
								<div class="sel_box">
									<select name="" id="tiemInterval">
										<option>시간 간격</option>
										<option>15분</option>
										<option>30분</option>
										<option>60분</option>
									</select>
								</div>
							</div>
							<div class="inp_box">
								<div class="sel_box">
									<select name="" id="lineup">
										<option>슬롯 당 인원</option>
										<option>1명</option>
										<option>2명</option>
										<option>3명</option>
										<option>4명</option>
										<option>5명</option>
										<option>6명</option>
									</select>
								</div>
							</div>
						</div>
					</div>
					<div class="inp_field">
						<label for="area">장소</label>
						<div class="inp_box" onclick="javascript:openPop('pop_tuning_location')"><input type="text" id="area" class="inp_txt" placeholder="장소를 입력해 주세요." readonly /></div>
						<span class="msg_error">필수 입력 사항입니다.</span>
					</div>
					<div class="btn_box"><button type="button" class="btn_add"><span>일정 추가</span></button></div>
					<ul class="list_type2">
						<li>
							<p class="txt_point_green"><b>2022-08-11 (목)</b></p>
							<p><b>10:00 AM ~ 3:00 PM</b></p>
							<p class="txt_people">15분마다 / 3명씩</p>
							<p class="txt_location">로캘리(서초대로 40길 96)</p>
							<button type="button" class="btn_del">삭제</button>
						</li>
						<li>
							<p class="txt_point_green"><b>2022-08-11 (목)</b></p>
							<p><b>10:00 AM ~ 3:00 PM</b></p>
							<p class="txt_people">15분마다 / 3명씩</p>
							<p class="txt_location">로캘리(서초대로 40길 96)</p>
							<button type="button" class="btn_del">삭제</button>
						</li>
					</ul>
					<button type="button" id="btnNext" class="btn_basic mt40 unactive">완료</button>
				</div>
			</form>
		</div>

		<!-- pop_tuning_location -->
		<div id="pop_tuning_location" class="dim_layer">
			<div class="dim"></div>
			<div class="pop_wrap">
				<div class="pop_handle" onclick="closePop('pop_tuning_location')"></div>
				<div class="pop_cont">
					<div class="sub_tit">오디션 장소 입력</div>
					<div class="addr_form">
						<div class="addr_search" id="addrSearch">
							<!-- tuning-location-1 -->
							<div class="search_box">
								<div class="inp_field">
									<input type="text" name="searchBar" id="searchBar" class="search_bar" placeholder="장소 이름이나 주소를 입력하세요."/>
									<button type="button" class="btn_reset" onclick="clearAddress(this)">X</button>
								</div>
							</div>

							<!-- tuning-location-2 -->
							<div class="addr_list" id="addrList">
								<!-- <div onclick="showAddrDetail(this)">
									<span class="label">에프티엔티</span>
									<div class="txt">서울 서초구 서초대로 40길 96</div>
								</div> -->
							</div>
						</div>

						<!-- tuning-location-3 -->
						<div class="addr_detail" id="addrDetail" style="display:none;">
							<div class="inp_field">
								<input type="text" name="locationName" id="locationName" class="location_name" placeholder="장소 이름이나 주소를 입력하세요." oninput="handleAddrDetail(this)" />
							</div>
							<div class="inp_field">
								<input type="text" name="locationAddress1" id="locationAddress1" class="location_address1" placeholder="주소를 입력해 주세요." oninput="handleAddrDetail(this)" />
							</div>
							<div class="inp_field">
								<input type="text" name="locationAddress2" id="locationAddress2" class="location_address2" placeholder="세부 주소를 입력해 주세요." oninput="handleAddrDetail(this)" />
							</div>

							<div class="fix_bottom">
								<button type="button" onclick="submitTuningLocation()" class="btn_line">장소입력완료</button>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<!--// pop_tuning_location -->

		<!-- pop_time -->
		<div id="pop_time" class="dim_layer">
			<div class="dim"></div>
			<div class="pop_wrap">
				<div class="pop_handle" onclick="closePop('pop_time')"></div>
				<div class="pop_head"><button type="button" class="btn_txt txt_point_green">저장</button></div>
				<div class="pop_cont">
					<!--<input id="fpTimePicker" class="time_selector" placeholder="9:00" />-->
					<div id="fpTimePicker"></div>
				</div>
			</div>
		</div>
		<!--// pop_time -->

		<!-- pop_calendar -->
		<div id="pop_calendar" class="dim_layer pop_calendar">
			<div class="dim"></div>
			<div class="pop_wrap">
				<div class="pop_handle" onclick="closePop('pop_calendar')"></div>
				<div class="pop_head"><button type="button" class="btn_txt txt_point_green">저장</button></div>
				<div class="pop_cont">
					<input id="fpCalendar" class="" placeholder="" style="display:none" />
				</div>
			</div>
		</div>
		<!--// pop_calendar -->
		
	</div><!-- //wrap -->
	<script>
		// 퍼블 확인용 json
		const testJson = [
			{
				"location_name": "에프티엔티",
				"location_addr": "서울 서초구 서초대로 40길 96",
			},
			{
				"location_name": "한샘리하우스 지움대리점",
				"location_addr": "서울 서초구 서초대로 40길 96",
			},
			{
				"location_name": "서울 서초구 41길 54",
				"location_addr": "서초동 157-4",
			}
		];

		// 퍼블 확인용 주소 렌더링
		function renderLocation(locations, container){
            let htmlContent = '';

            for (let i = 0; i < locations.length; i++) {
                htmlContent += `
					<div onclick="showAddrDetail(this)">
						<span class="label">${locations[i].location_name}</span>
						<div class="txt">${locations[i].location_addr}</div>
					</div>
                `;
            }
            container.innerHTML = htmlContent;
		}

		const addrSearch = document.querySelector('#addrSearch');	// 장소 검색 box
		const addrDetail = document.querySelector('#addrDetail');	// 장소 입력 box
		const searchBar = document.querySelector('#searchBar'); // 검색 input
		const addrList = document.querySelector('#addrList'); // 검색 List
		const locationName = document.querySelector('#locationName');	// 장소 이름
		const locationAddress1 = document.querySelector('#locationAddress1');	// 장소 메인 주소
		const locationAddress2 = document.querySelector('#locationAddress2');	// 장소 세부 주소

		function clearAddress(target){
			const addrList =  document.querySelector('#addrList');
			target.previousElementSibling.value = '';
			target.previousElementSibling.focus();
			target.style.display = 'none';

			addrList.innerHTML = '';
		}

		// handler 검색바
		searchBar.addEventListener('input', function(){
			const btnReset = this.nextElementSibling;
			// console.log(btnReset);

			if(this.value === ''){
				btnReset.style.display = 'none';
				addrList.innerHTML = '';

			}else{
				btnReset.style.display = 'block';
				renderLocation(testJson, addrList);
			}
		});

		function showAddrDetail(target){
			let locationNameValue = target.querySelector('.label').textContent;
			let locationAddressValue = target.querySelector('.txt').textContent;

			locationName.value = locationNameValue;
			locationAddress1.value = locationAddressValue;
			locationName.classList.add('active');
			locationAddress1.classList.add('active');

			addrSearch.style.display = 'none';
			addrDetail.style.display = 'block';
		}

		function handleAddrDetail(target){
			if(target.value === ''){
				target.classList.remove('active');
			}
		}

		function submitTuningLocation(){
			closePop('pop_tuning_location');

			// 팝업 초기화
			addrSearch.style.display = 'block';
			addrDetail.style.display = 'none';
			addrList.innerHTML = '';
			locationName.value = '';
			locationAddress1.value = '';
			locationAddress2.value = '';

			searchBar.value = '';
			searchBar.nextElementSibling.style.display = 'none';
		}

		const fpCalendar = document.querySelector('#fpCalendar')
		fpCalendar.flatpickr({
			inline: true,
			dateFormat: "Y-m-d",
			altFormat: "Y. n.",
			defaultDate: "today",
		});

		const fpTimePicker = document.querySelector('#fpTimePicker')
		fpTimePicker.flatpickr({
			inline: true,
			enableTime: true,
			noCalendar: true,
			dateFormat: "K H:i",
		});

		document.querySelector('#pop_calendar .btn_txt').addEventListener('click', function() {
			let timePickerValue = document.getElementById('fpCalendar').value;
			document.getElementById('date').value = timePickerValue;
			closePop('pop_calendar');
		});

		document.querySelector('#pop_time .btn_txt').addEventListener('click', function() {
			let timePickerValue = document.getElementById('fpTimePicker').value;
			document.getElementById('time').value = timePickerValue;
			closePop('pop_time');
		});
	</script>
</body>
</html>
