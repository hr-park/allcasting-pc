<!DOCTYPE html>
<html lang="ko">
<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1" />
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<title>All CASTING</title>
	<link rel="stylesheet" href="../static/css/NotoSansKR.css">
	<link rel="stylesheet" href="../static/css/style.css">
	<link rel="stylesheet" href="../static/css/swiper-bundle.min.css" />
    <link rel="stylesheet" href="../static/css/flatpickr.min.css">
	<script src="../static/js/swiper-bundle.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
	<script src="https://npmcdn.com/flatpickr/dist/l10n/ko.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
	<script src="../static/js/common.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
</head>
<body>
	<div class="wrap">
		<header class="header">
			<div class="inner">
				<div class="logo_wrap">
					<h1><a href="javascript:void(0)" class="logo"><img src="../static/images/logo.png" alt="ALLCASTING"></a></h1>
					<!-- Caster GNB -->
					<nav class="gnb">
						<a href="javascript:void(0)">홈</a>
						<a href="my_project_list.html">내 프로젝트</a>
						<a href="review_mng_list.html" class="active">심사 관리</a>
						<a href="javascript://">오디션 일정</a>
						<a href="my_artist_list.html">관심 아티스트</a>
					</nav>
					<!--// Caster GNB -->
				</div>
				<div class="header_actions">
					<a href="search.html" class="btn btn_search">검색</a>
					<a href="javascript:void(0)" class="btn btn_notification"><span class="badge_alert">새로운 알림</span></a>
					<a href="javascript:void(0)" class="btn btn_profile">
						<span class="profile_img">
							<img src="../static/images/profile_sample.jpg" alt="프로필">
						</span>
						<span class="badge_alert">새로운 알림</span>
					</a>
				</div>
			</div>
		</header>
		<main class="bg_white">
			<div class="inner">
				<div class="section_title">
					<h2>심사 하기</h2>
					<div class="desc_group">
						<p class="desc">지원 마감 후, 심사 시작 버튼 클릭후에 심사를 시작할 수 있습니다.</p>
						<button type="button" class="btn_common primary_line">지원 마감</button>
						<button type="button" class="btn_common primary">심사 확정</button>
					</div>
				</div>
				<p class="section_title_desc">나의 심사 내역을 모두 확인 할 수 있습니다.</p>
				<div class="view_top_grid">
					<div class="left">
						<div class="project">
							<div class="top_status">
								<div class="flex_center gap5">
									<strong class="d_day soon">D-2</strong>
									<div class="tag_list">
										<span class="tag tag_recommend">올캣추천</span>
										<span class="tag tag_urgent">마감임박</span>
										<span class="tag tag_verified">올캣인증</span>
										<span class="tag tag_new">NEW</span>
									</div>
								</div>
							</div>
							<p class="subject">[광고] 판타지 컨셉의 광고 영상</p>
							<div class="detail_row">
								<strong class="tit">모집분야</strong>
								<p class="desc">단역3(여성1, 남성2), 보조2, 크루1 외 1건</p>
							</div>
						</div>
					</div>
					<div class="right">
						<div class="project_summary">
							<div class="summary_item">
								<span class="label">리스트업</span>
								<span class="value">2,345명</span>
							</div>
							<div class="summary_item">
								<span class="label">오디션 제안</span>
								<span class="value">
									<span class="tag tag_new">NEW</span>
									<span class="cnt">123</span>
								</span>
							</div>
							<div class="summary_item">
								<span class="label">캐스팅</span>
								<span class="value">1</span>
							</div>
						</div>
					</div>
				</div>
				<section class="review_view_grid">
					<div class="review_view_left">
						<div class="section_title">
							<h2>심사 대상<span class="cnt">2,345명</span></h2>
							<div class="custom_select min">
								<select>
									<option value="">최근 지원 순</option>
								</select>
							</div>
						</div>
						<p class="section_title_desc">심사를 진행해야하는 지원자입니다.</p>
						<ul class="profile_list">
							<li class="profile_item">
								<div class="profile_img">
									<img src="../static/images/profile_sample2.jpg" alt="김아티스트">
									<button type="button" class="btn_bookmark active" onclick="toggleActiveClass(this)">bookmark</button>
								</div>
								<div class="profile_info">
									<div class="profile_header">
										<div class="top_status">
											<div class="flex_center gap5">
												<h3 class="name">김시현</h3>
												<span class="tag tag_verified">올캣인증</span>
											</div>
										</div>
										<ul class="sub_dot_list min">
											<li>25세</li>
											<li>여성</li>
											<li>국내 전체</li>
										</ul>
									</div>
									<p class="profile_details">165cm / 46kg / 경력 33건 <span class="tag tag_famous">인기</span></p>
									<div class="star-rating">
										<span class="star filled">★</span>
										<span class="star filled">★</span>
										<span class="star filled">★</span>
										<span class="star filled">★</span>
										<span class="star half">★</span>
									  </div>
								</div>
							</li>
						</ul>
						<button type="button" class="btn_more_list">더보기</button>
					</div>
					<div class="review_view_right">
						<!-- 리스트업 섹션 -->
						<div class="review_section" data-category="listup">
							<p class="tit">리스트업<span class="cnt">0</span></p>
							<div class="drop_zone">
								<p class="drop_text">여기로 배우 프로필을<br>드래그해서 가져오세요.</p>
							</div>
						</div>

						<!-- 오디션제안 섹션 -->
						<div class="review_section" data-category="audition">
							<p class="tit">오디션제안<span class="cnt">0</span></p>
							<div class="drop_zone">
								<p class="drop_text">여기로 배우 프로필을<br>드래그해서 가져오세요.</p>
							</div>
						</div>

						<!-- 캐스팅 섹션 -->
						<div class="review_section casting" data-category="casting">
							<p class="tit">캐스팅<span class="cnt">0</span></p>
							<div class="drop_zone">
								<p class="drop_text">여기로 배우 프로필을<br>드래그해서 가져오세요.</p>
							</div>
						</div>
					</div>
				</section>
			</div>	
		</main>

		<footer class="footer">
			<div class="inner">
				<div class="top">
					<div class="logo"><img src="../static/images/logo.png" alt="ALLCASTING"></div>
					<div class="btns">
						<a href="javascript:void(0)" class="ft_pill">아티스트를 찾는다면?</a>
						<a href="javascript:void(0)" class="ft_pill">프로젝트를 찾는다면?</a>
						<a href="javascript:void(0)" class="ft_sns insta">instagram</a>
						<a href="javascript:void(0)" class="ft_sns youtube">youtube</a>
					</div>
				</div>
				<div class="legal">
					<p class="row">Copyright © 2025 ALLCASTING. All rights reserved.</p>
					<p class="row">(주)올캣 · 대표자: 홍길동 · 사업자등록번호: 111-22-3333 · 통신판매업 신고번호: 2025-서울강남-01010101</p>
					<p class="row">사업장 소재지: 서울특별시 강남구 여기여기 주소가 들어갑니다.</p>
					<p class="row links"><a href="javascript://">이용약관</a> &middot; <a href="javascript://">개인정보처리방침</a></p>
				</div>
			</div>
		</footer>
	</div>
	<script>
	// 퍼블 페이지 확인용
	const urlParams = new URL(location.href).searchParams;
	const state = urlParams.get('status');
	if (state === 'none') {
		//document.querySelector('.list_none').style.display = 'block';
		//document.querySelector('.bg_cont_gray').style.display = 'none';
	}
	
	// profile_list 10개 반복 생성
	const profileList = document.querySelector('.profile_list');
	const names = ['김시현', '이민수', '박지영', '최수진', '정현우', '한소영', '윤태호', '강미래', '조성민', '임하늘'];
	const ages = ['25세', '28세', '23세', '30세', '26세', '24세', '29세', '27세', '31세', '22세'];
	const genders = ['여성', '남성', '여성', '여성', '남성', '여성', '남성', '여성', '남성', '여성'];
	const regions = ['국내 전체', '서울', '경기', '부산', '대구', '인천', '광주', '대전', '울산', '세종'];
	const heights = ['165cm', '180cm', '160cm', '168cm', '175cm', '162cm', '182cm', '170cm', '178cm', '158cm'];
	const weights = ['46kg', '75kg', '48kg', '52kg', '70kg', '50kg', '78kg', '55kg', '72kg', '45kg'];
	const experiences = ['33건', '45건', '28건', '52건', '38건', '31건', '48건', '35건', '41건', '25건'];

	for (let i = 0; i < 10; i++) {
		const li = document.createElement('li');
		li.className = 'profile_item';
		li.innerHTML = `
			<div class="profile_img">
				<img src="../static/images/profile_sample2.jpg"  alt="${names[i]}">
				<button type="button" class="btn_bookmark active" onclick="toggleActiveClass(this)">bookmark</button>
			</div>
			<div class="profile_info">
				<div class="profile_header">
					<div class="top_status">
						<div class="flex_center gap5">
							<p class="name">${names[i]}</p>
							<span class="tag tag_verified">올캣인증</span>
						</div>
					</div>
					<ul class="sub_dot_list min">
						<li>${ages[i]}</li>
						<li>${genders[i]}</li>
						<li>${regions[i]}</li>
					</ul>
				</div>
				<p class="profile_details">${heights[i]} / ${weights[i]} / 경력 ${experiences[i]} <span class="tag tag_famous">인기</span></p>
				<div class="star-rating">
					<span class="star filled">★</span>
					<span class="star filled">★</span>
					<span class="star filled">★</span>
					<span class="star filled">★</span>
					<span class="star half">★</span>
				</div>
			</div>
		`;

		profileList.appendChild(li);
	}
	
	// 드래그 중인 요소 정보를 저장할 전역 변수
	let draggedElementInfo = null;
	
	// 미리보기 표시 함수
	function showPreview(dropZone, elementInfo) {
		try {
			// 기존 미리보기 제거
			hidePreview(dropZone);
			
			// 이미 미리보기가 있으면 중복 생성하지 않음
			if (dropZone.querySelector('.drag-preview')) {
				return;
			}
			
			// 같은 이름의 프로필이 이미 있는지 확인
			const existingProfiles = dropZone.querySelectorAll('.dropped_profile:not(.drag-preview)');
			let isDuplicate = false;
			existingProfiles.forEach(profile => {
				const existingName = profile.querySelector('.profile_name').textContent;
				if (existingName === elementInfo.name) {
					isDuplicate = true;
				}
			});
			
			// 중복된 프로필이면 미리보기 표시하지 않음
			if (isDuplicate) {
				return;
			}
			
			const section = dropZone.closest('.review_section');
			const isCastingSection = section && section.classList.contains('casting');
			
			// 새로운 미리보기 생성
			const preview = document.createElement('div');
			preview.className = 'dropped_profile drag-preview';
			preview.innerHTML = `
				<div class="dropped_profile_img">
					${elementInfo.img || ''}
				</div>
				<p class="profile_name">${elementInfo.name || ''}</p>
				<button type="button" class="remove_btn" onclick="removeProfile(this)">삭제</button>
			`;
			
			// 드롭 존이 비어있으면 미리보기 추가
			if (existingProfiles.length === 0) {
				if (isCastingSection) {
					// 캐스팅 섹션: 미리보기와 메시지 함께 표시
					dropZone.innerHTML = '';
					dropZone.appendChild(preview);
					const castingMessage = document.createElement('p');
					castingMessage.className = 'drop_text casting_message';
					castingMessage.innerHTML = '심사 확정 후,<br>캐스팅 콜이 가능합니다.';
					dropZone.appendChild(castingMessage);
				} else {
					// 일반 섹션: 미리보기만 표시
					dropZone.innerHTML = '';
					dropZone.appendChild(preview);
				}
			} else {
				// 기존 프로필이 있으면 미리보기를 맨 끝에 추가
				dropZone.appendChild(preview);
			}
		} catch (error) {
			console.log('미리보기 표시 함수 오류:', error);
		}
	}
	
	// 미리보기 숨김 함수
	function hidePreview(dropZone) {
		try {
			const existingPreview = dropZone.querySelector('.drag-preview');
			if (existingPreview) {
				existingPreview.remove();
			}
		} catch (error) {
			console.log('미리보기 숨김 함수 오류:', error);
		}
	}
	
	// SortableJS를 사용한 드래그 앤 드롭 설정
	setupSortableDragAndDrop();

	// SortableJS 드래그 앤 드롭 기능
	function setupSortableDragAndDrop() {
		// 프로필 리스트를 Sortable로 설정
		const profileList = document.querySelector('.profile_list');
		if (profileList) {
			new Sortable(profileList, {
				group: {
					name: 'profiles',
					pull: 'clone',
					put: false
				},
				sort: false,
				animation: 150,
				ghostClass: 'sortable-ghost',
				chosenClass: 'sortable-chosen',
				dragClass: 'sortable-drag',
				onStart: function(evt) {
					evt.item.classList.add('dragging');
					// 드래그 중인 요소 정보 저장
					const profileName = evt.item.querySelector('.name').textContent;
					const profileImg = evt.item.querySelector('.profile_img');
					draggedElementInfo = {
						name: profileName,
						img: profileImg ? profileImg.innerHTML : ''
					};
				},
				onEnd: function(evt) {
					evt.item.classList.remove('dragging');
					// 드래그 정보 초기화
					draggedElementInfo = null;
					
					// 모든 미리보기 제거
					const allPreviews = document.querySelectorAll('.drag-preview');
					allPreviews.forEach(preview => preview.remove());
					
					// 드롭 존에 드롭된 경우 profile_item이 남아있다면 제거
					if (evt.to && evt.to.classList.contains('drop_zone')) {
						const profileItems = evt.to.querySelectorAll('.profile_item');
						profileItems.forEach(item => {
							// profile_item이 드롭 존에 남아있다면 제거
							if (item.parentNode === evt.to) {
								item.remove();
							}
						});
					}
				}
			});
		}

		// 각 드롭 존을 Sortable로 설정
		const dropZones = document.querySelectorAll('.drop_zone');
		dropZones.forEach((zone, index) => {
			new Sortable(zone, {
				group: {
					name: 'profiles',
					pull: false,
					put: true
				},
				animation: 150,
				ghostClass: 'sortable-ghost',
				chosenClass: 'sortable-chosen',
				dragClass: 'sortable-drag',
				onMove: function(evt) {
					// 드래그 중에 드롭 존에 들어왔을 때 미리보기 표시
					try {
						if (evt.to && evt.to.classList.contains('drop_zone') && draggedElementInfo) {
							showPreview(evt.to, draggedElementInfo);
						}
					} catch (error) {
						console.log('미리보기 표시 중 오류:', error);
					}
				},
				onEnd: function(evt) {
					// 드래그가 끝나면 모든 미리보기 제거
					const allPreviews = document.querySelectorAll('.drag-preview');
					allPreviews.forEach(preview => preview.remove());
				},
				onAdd: function(evt) {
					const draggedElement = evt.item;
					const section = evt.to.closest('.review_section');
					
					// 드롭된 프로필 정보 가져오기
					const profileName = draggedElement.querySelector('.name').textContent;
					const profileImg = draggedElement.querySelector('.profile_img');
					
					// 기존 미리보기 제거
					hidePreview(evt.to);
					
					// 기존 드롭된 프로필이 있는지 확인 (미리보기 제외)
					const existingProfiles = evt.to.querySelectorAll('.dropped_profile:not(.drag-preview)');
					
					// 같은 이름의 프로필이 이미 있는지 확인
					let isDuplicate = false;
					existingProfiles.forEach(profile => {
						const existingName = profile.querySelector('.profile_name').textContent;
						if (existingName === profileName) {
							isDuplicate = true;
						}
					});
					
					// 중복된 프로필이면 드롭 취소
					if (isDuplicate) {
						evt.item.remove();
						alert('이미 추가된 프로필입니다.');
						return;
					}
					
					// 카운트 업데이트
					const countElement = section.querySelector('.cnt');
					const currentCount = parseInt(countElement.textContent);
					countElement.textContent = currentCount + 1;
					
					// 캐스팅 섹션인지 확인
					const isCastingSection = section.classList.contains('casting');
					
					// 드롭된 요소를 즉시 제거하고 새로운 dropped_profile로 교체
					evt.item.remove();
					
					if (existingProfiles.length === 0) {
						if (isCastingSection) {
							// 캐스팅 섹션: 프로필과 안내 텍스트 함께 표시
							evt.to.innerHTML = `
								<div class="dropped_profile">
									<div class="dropped_profile_img">
										${profileImg.innerHTML}
									</div>
									<p class="profile_name">${profileName}</p>
									<button type="button" class="remove_btn" onclick="removeProfile(this)">삭제</button>
								</div>
								<p class="drop_text casting_message">심사 확정 후,<br>캐스팅 콜이 가능합니다.</p>
							`;
						} else {
							// 일반 섹션: 프로필만 표시
							evt.to.innerHTML = `
								<div class="dropped_profile">
									<div class="dropped_profile_img">
										${profileImg.innerHTML}
									</div>
									<p class="profile_name">${profileName}</p>
									<button type="button" class="remove_btn" onclick="removeProfile(this)">삭제</button>
								</div>
							`;
						}
					} else {
						// 기존 프로필이 있는 경우 새 프로필 추가
						const newProfile = document.createElement('div');
						newProfile.className = 'dropped_profile';
						newProfile.innerHTML = `
							<div class="dropped_profile_img">
								${profileImg.innerHTML}
							</div>
							<p class="profile_name">${profileName}</p>
							<button type="button" class="remove_btn" onclick="removeProfile(this)">삭제</button>
						`;
						
						if (isCastingSection) {
							// 캐스팅 섹션: 캐스팅 메시지 앞에 프로필 추가
							const castingMessage = evt.to.querySelector('.casting_message');
							if (castingMessage) {
								evt.to.insertBefore(newProfile, castingMessage);
							} else {
								evt.to.appendChild(newProfile);
							}
						} else {
							// 일반 섹션: 맨 끝에 추가
							evt.to.appendChild(newProfile);
						}
					}
				}
			});
		});
	}

	function removeProfile(btn) {
		const profileToRemove = btn.closest('.dropped_profile');
		const dropZone = profileToRemove.closest('.drop_zone');
		const section = dropZone.closest('.review_section');
		const countElement = section.querySelector('.cnt');
		const currentCount = parseInt(countElement.textContent);
		countElement.textContent = currentCount - 1;
		
		// 프로필 제거
		profileToRemove.remove();
		
		// 드롭 존에 프로필이 없으면 기본 텍스트 표시
		const remainingProfiles = dropZone.querySelectorAll('.dropped_profile');
		if (remainingProfiles.length === 0) {
			const isCastingSection = section.classList.contains('casting');
			if (isCastingSection) {
				dropZone.innerHTML = '<p class="drop_text">여기로 배우 프로필을<br>드래그해서 가져오세요.</p>';
			} else {
				dropZone.innerHTML = '<p class="drop_text">여기로 배우 프로필을<br>드래그해서 가져오세요.</p>';
			}
		}
	}

	// DOM 로드 후 SortableJS 드래그 앤 드롭 설정
	document.addEventListener('DOMContentLoaded', setupSortableDragAndDrop);
	</script>
</body>
</html>